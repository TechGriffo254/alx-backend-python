# Environment Variables Configuration Template

## Copy these to your Render services (both Web and Worker)

### Core Django Settings
```bash
# Secret key - let Render auto-generate this
SECRET_KEY=<auto-generated-by-render>

# Debug mode - MUST be False in production
DEBUG=False

# Allowed hosts - add your Render domain
ALLOWED_HOSTS=your-app-name.onrender.com
```

### Database Configuration (PostgreSQL)
```bash
# These values come from your PostgreSQL service in Render
DB_ENGINE=django.db.backends.postgresql
DB_NAME=<from-postgres-service>
DB_USER=<from-postgres-service>
DB_PASSWORD=<from-postgres-service>
DB_HOST=<internal-host-from-postgres>
DB_PORT=5432
```

**How to get database values:**
1. Go to your PostgreSQL service in Render
2. Click "Info" tab
3. Use the "Internal Database URL" components:
   - Host: Look for hostname (e.g., dpg-xxxxx-a.oregon-postgres.render.com)
   - Database: Usually the service name
   - Username: Usually matches database name
   - Password: Shown in the connection string

### Celery Configuration (Redis)
```bash
# These values come from your Redis service in Render
CELERY_BROKER_URL=redis://<redis-internal-url>
CELERY_RESULT_BACKEND=redis://<redis-internal-url>
```

**How to get Redis URL:**
1. Go to your Redis service in Render
2. Copy the "Internal Redis URL" (starts with redis://)
3. Use the same URL for both CELERY_BROKER_URL and CELERY_RESULT_BACKEND

### Email Configuration (Gmail)
```bash
EMAIL_BACKEND=django.core.mail.backends.smtp.EmailBackend
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USE_TLS=True
EMAIL_HOST_USER=your-email@gmail.com
EMAIL_HOST_PASSWORD=<gmail-app-password>
DEFAULT_FROM_EMAIL=noreply@messagingapp.com
```

**How to get Gmail app password:**
1. Go to https://myaccount.google.com/
2. Security → 2-Step Verification (enable if not already)
3. Security → App passwords
4. Select app: "Mail"
5. Select device: "Other" (name it "Render Django")
6. Copy the 16-character password (no spaces)

### CORS Configuration
```bash
# Comma-separated list of allowed origins
CORS_ALLOWED_ORIGINS=https://your-app-name.onrender.com

# Set to False for security
CORS_ALLOW_ALL_ORIGINS=False
```

### Security Settings
```bash
# Enable SSL redirect (Render provides HTTPS automatically)
SECURE_SSL_REDIRECT=True
```

---

## Alternative: Using .env File Locally

If testing locally before deployment, create a `.env` file:

```bash
# .env file (DO NOT commit this to Git)
SECRET_KEY=your-local-secret-key-for-development
DEBUG=True
ALLOWED_HOSTS=localhost,127.0.0.1

# Local Database (SQLite for development)
DB_ENGINE=django.db.backends.sqlite3
DB_NAME=db.sqlite3

# Local Celery (requires local RabbitMQ and Redis)
CELERY_BROKER_URL=amqp://guest:guest@localhost:5672//
CELERY_RESULT_BACKEND=redis://localhost:6379/0

# Email (Console backend for development)
EMAIL_BACKEND=django.core.mail.backends.console.EmailBackend

# CORS (allow all for local testing)
CORS_ALLOW_ALL_ORIGINS=True

# Security (disabled for local)
SECURE_SSL_REDIRECT=False
```

---

## Complete Environment Variables List for Render

### For Web Service (messaging-app-web)

| Variable | Value | Source |
|----------|-------|--------|
| PYTHON_VERSION | 3.11 | Manual |
| SECRET_KEY | (auto-generated) | Render |
| DEBUG | False | Manual |
| ALLOWED_HOSTS | your-app.onrender.com | Manual |
| DB_ENGINE | django.db.backends.postgresql | Manual |
| DB_NAME | (from PostgreSQL) | PostgreSQL Service |
| DB_USER | (from PostgreSQL) | PostgreSQL Service |
| DB_PASSWORD | (from PostgreSQL) | PostgreSQL Service |
| DB_HOST | (from PostgreSQL) | PostgreSQL Service |
| DB_PORT | 5432 | Manual |
| CELERY_BROKER_URL | (from Redis) | Redis Service |
| CELERY_RESULT_BACKEND | (from Redis) | Redis Service |
| EMAIL_BACKEND | django.core.mail.backends.smtp.EmailBackend | Manual |
| EMAIL_HOST | smtp.gmail.com | Manual |
| EMAIL_PORT | 587 | Manual |
| EMAIL_USE_TLS | True | Manual |
| EMAIL_HOST_USER | your-email@gmail.com | Manual |
| EMAIL_HOST_PASSWORD | (Gmail app password) | Manual |
| DEFAULT_FROM_EMAIL | noreply@messagingapp.com | Manual |
| CORS_ALLOW_ALL_ORIGINS | False | Manual |
| SECURE_SSL_REDIRECT | True | Manual |

### For Worker Service (messaging-app-celery-worker)

Use the **exact same** environment variables as the Web Service.

---

## Step-by-Step: Adding Variables in Render

1. **Navigate to Service:**
   - Go to Render Dashboard
   - Click on your service (web or worker)

2. **Open Environment Tab:**
   - Click "Environment" in the left sidebar

3. **Add Variables:**
   - Click "Add Environment Variable"
   - Enter the Key (e.g., `DEBUG`)
   - Enter the Value (e.g., `False`)
   - Click "Save"

4. **Link to Other Services:**
   - For database variables, click "Add from Database"
   - Select your PostgreSQL service
   - It will auto-populate DB_NAME, DB_USER, etc.

5. **Save Changes:**
   - After adding all variables, click "Save Changes"
   - Service will automatically redeploy

---

## Verification

After setting environment variables, check:

1. **View Active Variables:**
   - Service → Environment tab
   - You should see all variables listed

2. **Check Logs:**
   - Service → Logs tab
   - Look for successful connection messages

3. **Test Configuration:**
   ```bash
   # In Render shell
   python manage.py check --deploy
   ```

---

## Security Notes

⚠️ **IMPORTANT:**
- Never commit `.env` files to Git
- Use Render's environment variable UI for production
- Rotate secrets regularly
- Use strong passwords
- Enable 2FA on all accounts

✅ **Best Practices:**
- Use different secrets for dev/production
- Store sensitive values only in Render, not in code
- Regularly review and update environment variables
- Monitor logs for unauthorized access attempts

---

## Troubleshooting Environment Variables

### Variable Not Taking Effect
- Save changes in Render UI
- Wait for automatic redeploy
- Check logs for syntax errors

### Database Connection Issues
- Verify DB_HOST is the internal host
- Ensure all DB_* variables are set
- Check PostgreSQL service is available

### Email Not Working
- Verify EMAIL_HOST_PASSWORD is the app password (not regular Gmail password)
- Check EMAIL_USE_TLS is True (not "True" string)
- Test with a simple email first

### Celery Not Connecting to Redis
- Use Internal Redis URL, not External
- Ensure CELERY_BROKER_URL and CELERY_RESULT_BACKEND are set
- Check Redis service is running

---

## Quick Copy-Paste Template

Replace placeholders with your actual values:

```bash
SECRET_KEY=<generate-or-let-render-do-it>
DEBUG=False
ALLOWED_HOSTS=<your-app-name>.onrender.com
DB_ENGINE=django.db.backends.postgresql
DB_NAME=<your-db-name>
DB_USER=<your-db-user>
DB_PASSWORD=<your-db-password>
DB_HOST=<your-internal-db-host>
DB_PORT=5432
CELERY_BROKER_URL=<your-redis-url>
CELERY_RESULT_BACKEND=<your-redis-url>
EMAIL_BACKEND=django.core.mail.backends.smtp.EmailBackend
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USE_TLS=True
EMAIL_HOST_USER=<your-email@gmail.com>
EMAIL_HOST_PASSWORD=<your-gmail-app-password>
DEFAULT_FROM_EMAIL=noreply@messagingapp.com
CORS_ALLOW_ALL_ORIGINS=False
SECURE_SSL_REDIRECT=True
```

---

Need help? Check [RENDER_DEPLOYMENT_GUIDE.md](RENDER_DEPLOYMENT_GUIDE.md) for full deployment instructions.
